import math

def calculate_heat_storage_tank():
    try:
        # Исходные данные
        Qhhr = 152.7    # Максимальный часовой расход тепла, кВт
        Qht = 4.7       # Среднечасовой расход тепла, кВт
        Qsp = 20.0      # Расчетная мощность водоподогревателя, кВт
        T = 12.0        # Период потребления, ч
        th = 65.0       # Температура горячей воды, °C
        tc = 5.0        # Температура холодной воды, °C

        # Валидация входных данных
        if th <= tc:
            raise ValueError("Температура горячей воды должна быть выше холодной")
        if Qhhr <= Qht:
            raise ValueError("Максимальный расход должен превышать средний")

        # Расчет коэффициентов
        K = round(Qhhr / Qht, 2)
        Ksp = round(Qsp / Qht, 2)

        # Расчет коэффициента формы графика нагрузки (формула из СНиП 2.04.01-85)
        try:
            # Расчет первой части формулы
            term1 = 1 - Ksp
            term2 = (K-1) * (Ksp/K)**(K/(K-1))
            term3 = ((Ksp-1)/K)**K
            phi1 = round(term1 + term2 + term3, 2)
            
            # Расчет второй части формулы
            phi2 = round(term1 + term2, 2)
        except ZeroDivisionError:
            raise ValueError("Недопустимые значения коэффициентов")

        # Расчет объема бака-аккумулятора
        delta_t = th - tc
        W = round(phi1 * T * Qht / (1.163 * delta_t), 2)  # 1.163 - коэффициент перевода кВт в Гкал/ч

        # Подбор стандартного объема бака
        standard_tanks = [0.5, 1.0, 1.5, 2.0, 3.0, 5.0]
        selected_tank = min((t for t in standard_tanks if t >= W), default=max(standard_tanks))

        # Форматированный вывод
        print("Регулирующий объем бака-аккумулятора теплоты в системе ГВС\n")
        print("Исходные данные:")
        print(f"- Максимальный часовой расход тепла (Qhhr): {Qhhr} кВт")
        print(f"- Среднечасовой расход тепла (Qht): {Qht} кВт")
        print(f"- Мощность водоподогревателя (Qsp): {Qsp} кВт")
        print(f"- Температура горячей воды: {th} °C")
        print(f"- Температура холодной воды: {tc} °C")
        print(f"- Период потребления: {T} ч\n")

        print("Расчетные параметры:")
        print(f"Коэффициент неравномерности K = Qhhr/Qht = {K}")
        print(f"Коэффициент мощности Ksp = Qsp/Qht = {Ksp}")
        print(f"Коэффициент формы графика φ = {phi1}\n")

        print(f"Расчетный объем бака: {W} м³")
        print(f"Рекомендуемый объем: {selected_tank} м³ ({math.ceil(W/0.5)*0.5} м³ с округлением вверх)")
        print("\nОбоснование: СНиП 2.04.01-85 п.9.3. Расчет аккумуляторов теплоты")

    except Exception as e:
        print(f"Ошибка расчета: {str(e)}")

# Запуск расчета
calculate_heat_storage_tank()
